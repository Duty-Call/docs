"use strict";(self.webpackChunkdocs_dutycall=self.webpackChunkdocs_dutycall||[]).push([[6102],{1470:(e,n,l)=>{l.d(n,{A:()=>w});var i=l(6540),r=l(4164),s=l(7559),o=l(3104),c=l(6347),t=l(205),d=l(7485),a=l(1682),h=l(679);function u(e){var n,l;return null!=(n=null==(l=i.Children.toArray(e).filter(function(e){return"\n"!==e}).map(function(e){if(!e||(0,i.isValidElement)(e)&&((n=e.props)&&"object"==typeof n&&"value"in n))return e;var n;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))?void 0:l.filter(Boolean))?n:[]}function x(e){var n=e.values,l=e.children;return(0,i.useMemo)(function(){var e=null!=n?n:function(e){return u(e).map(function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes,default:n.default}})}(l);return function(e){var n=(0,a.XI)(e,function(e,n){return e.value===n.value});if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map(function(e){return e.value}).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e},[n,l])}function p(e){var n=e.value;return e.tabValues.some(function(e){return e.value===n})}function j(e){var n=e.queryString,l=void 0!==n&&n,r=e.groupId,s=(0,c.W6)(),o=function(e){var n=e.queryString,l=void 0!==n&&n,i=e.groupId;if("string"==typeof l)return l;if(!1===l)return null;if(!0===l&&!i)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=i?i:null}({queryString:l,groupId:r});return[(0,d.aZ)(o),(0,i.useCallback)(function(e){if(o){var n=new URLSearchParams(s.location.search);n.set(o,e),s.replace(Object.assign({},s.location,{search:n.toString()}))}},[o,s])]}function g(e){var n,l,r,s,o=e.defaultValue,c=e.queryString,d=void 0!==c&&c,a=e.groupId,u=x(e),g=(0,i.useState)(function(){return function(e){var n,l=e.defaultValue,i=e.tabValues;if(0===i.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(l){if(!p({value:l,tabValues:i}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+l+'" but none of its children has the corresponding value. Available values are: '+i.map(function(e){return e.value}).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return l}var r=null!=(n=i.find(function(e){return e.default}))?n:i[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:o,tabValues:u})}),v=g[0],m=g[1],f=j({queryString:d,groupId:a}),b=f[0],_=f[1],P=(n=function(e){return e?"docusaurus.tab."+e:null}({groupId:a}.groupId),l=(0,h.Dv)(n),r=l[0],s=l[1],[r,(0,i.useCallback)(function(e){n&&s.set(e)},[n,s])]),w=P[0],A=P[1],R=function(){var e=null!=b?b:w;return p({value:e,tabValues:u})?e:null}();return(0,t.A)(function(){R&&m(R)},[R]),{selectedValue:v,selectValue:(0,i.useCallback)(function(e){if(!p({value:e,tabValues:u}))throw new Error("Can't select invalid tab value="+e);m(e),_(e),A(e)},[_,A,u]),tabValues:u}}var v=l(2303);const m={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=l(4848);function b(e){var n=e.className,l=e.block,i=e.selectedValue,s=e.selectValue,c=e.tabValues,t=[],d=(0,o.a_)().blockElementScrollPositionUntilNextRender,a=function(e){var n=e.currentTarget,l=t.indexOf(n),r=c[l].value;r!==i&&(d(n),s(r))},h=function(e){var n,l=null;switch(e.key){case"Enter":a(e);break;case"ArrowRight":var i,r=t.indexOf(e.currentTarget)+1;l=null!=(i=t[r])?i:t[0];break;case"ArrowLeft":var s,o=t.indexOf(e.currentTarget)-1;l=null!=(s=t[o])?s:t[t.length-1]}null==(n=l)||n.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":l},n),children:c.map(function(e){var n=e.value,l=e.label,s=e.attributes;return(0,f.jsx)("li",Object.assign({role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:function(e){t.push(e)},onKeyDown:h,onClick:a},s,{className:(0,r.A)("tabs__item",m.tabItem,null==s?void 0:s.className,{"tabs__item--active":i===n}),children:null!=l?l:n}),n)})})}function _(e){var n=e.lazy,l=e.children,s=e.selectedValue,o=(Array.isArray(l)?l:[l]).filter(Boolean);if(n){var c=o.find(function(e){return e.props.value===s});return c?(0,i.cloneElement)(c,{className:(0,r.A)("margin-top--md",c.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:o.map(function(e,n){return(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==s})})})}function P(e){var n=g(e);return(0,f.jsxs)("div",{className:(0,r.A)(s.G.tabs.container,"tabs-container",m.tabList),children:[(0,f.jsx)(b,Object.assign({},n,e)),(0,f.jsx)(_,Object.assign({},n,e))]})}function w(e){var n=(0,v.A)();return(0,f.jsx)(P,Object.assign({},e,{children:u(e.children)}),String(n))}},8453:(e,n,l)=>{l.d(n,{R:()=>o,x:()=>c});var i=l(6540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}},9365:(e,n,l)=>{l.d(n,{A:()=>o});l(6540);var i=l(4164);const r={tabItem:"tabItem_Ymn6"};var s=l(4848);function o(e){var n=e.children,l=e.hidden,o=e.className;return(0,s.jsx)("div",{role:"tabpanel",className:(0,i.A)(r.tabItem,o),hidden:l,children:n})}},9571:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>x,frontMatter:()=>t,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"developers/getting-started/environment-config","title":"Environment Configuration","description":"Configure DutyCall for local development and production deployment.","source":"@site/docs/developers/getting-started/environment-config.md","sourceDirName":"developers/getting-started","slug":"/developers/getting-started/environment-config","permalink":"/developers/getting-started/environment-config","draft":false,"unlisted":false,"editUrl":"https://github.com/dutycall/docs/tree/main/docs/developers/getting-started/environment-config.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docs","previous":{"title":"Full-Stack Local Development Setup","permalink":"/developers/getting-started/local-setup"},"next":{"title":"API Reference","permalink":"/developers/api-reference"}}');var r=l(4848),s=l(8453),o=l(1470),c=l(9365);const t={sidebar_position:2},d="Environment Configuration",a={},h=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Backend Environment (.env)",id:"backend-environment-env",level:2},{value:"Local Development",id:"local-development",level:3},{value:"Production (Railway)",id:"production-railway",level:3},{value:"Frontend Environment (.env.local)",id:"frontend-environment-envlocal",level:2},{value:"Local Development",id:"local-development-1",level:3},{value:"Production (Vercel)",id:"production-vercel",level:3},{value:"The NGROK_URL Pattern",id:"the-ngrok_url-pattern",level:2},{value:"Why NGROK_URL Exists",id:"why-ngrok_url-exists",level:3},{value:"How It Works in Code",id:"how-it-works-in-code",level:3},{value:"Automatic Configuration",id:"automatic-configuration",level:3},{value:"Pattern Implementation",id:"pattern-implementation",level:3},{value:"Environment-Specific Differences",id:"environment-specific-differences",level:2},{value:"Local vs Production Comparison",id:"local-vs-production-comparison",level:3},{value:"What Changes Between Environments",id:"what-changes-between-environments",level:3},{value:"Technical Differences",id:"technical-differences",level:3},{value:"Twilio Configuration",id:"twilio-configuration",level:2},{value:"Phone Number Configuration",id:"phone-number-configuration",level:3},{value:"TwiML App Configuration",id:"twiml-app-configuration",level:3},{value:"Environment Variables Explained",id:"environment-variables-explained",level:3},{value:"Webhook Endpoints",id:"webhook-endpoints",level:3},{value:"Access Token Generation",id:"access-token-generation",level:3},{value:"CORS Configuration",id:"cors-configuration",level:2},{value:"Understanding CORS",id:"understanding-cors",level:3},{value:"Local Development",id:"local-development-2",level:3},{value:"Production",id:"production",level:3},{value:"CORS Implementation",id:"cors-implementation",level:3},{value:"Common Configuration Issues",id:"common-configuration-issues",level:2},{value:"Issue: Frontend Can&#39;t Connect to Backend",id:"issue-frontend-cant-connect-to-backend",level:3},{value:"Issue: Twilio Webhooks Failing",id:"issue-twilio-webhooks-failing",level:3},{value:"Issue: Device Not Registering (WebRTC)",id:"issue-device-not-registering-webrtc",level:3},{value:"Debugging Patterns",id:"debugging-patterns",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Security",id:"security",level:3},{value:"Development Workflow",id:"development-workflow",level:3},{value:"Production Deployment",id:"production-deployment",level:3},{value:"Configuration Management",id:"configuration-management",level:3},{value:"Next Steps",id:"next-steps",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"environment-configuration",children:"Environment Configuration"})}),"\n",(0,r.jsx)(n.p,{children:"Configure DutyCall for local development and production deployment."}),"\n","\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),(0,r.jsx)(n.p,{children:"DutyCall uses environment variables to configure backend and frontend behavior. This guide covers:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Local development configuration (",(0,r.jsx)(n.code,{children:".env"})," and ",(0,r.jsx)(n.code,{children:".env.local"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Production deployment configuration (Railway + Vercel)"}),"\n",(0,r.jsx)(n.li,{children:"Environment-specific differences"}),"\n"]})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Two-Environment System"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Local"}),": MySQL + ngrok tunneling + localhost"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Production"}),": PostgreSQL + Railway + Vercel"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Pattern"}),": ",(0,r.jsx)(n.code,{children:"env('NGROK_URL', env('APP_URL'))"})]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Local: Uses ",(0,r.jsx)(n.code,{children:"NGROK_URL"})," for Twilio callbacks"]}),"\n",(0,r.jsxs)(n.li,{children:["Production: Falls back to ",(0,r.jsx)(n.code,{children:"APP_URL"})," (no ",(0,r.jsx)(n.code,{children:"NGROK_URL"})," set)"]}),"\n"]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"backend-environment-env",children:"Backend Environment (.env)"}),"\n",(0,r.jsx)(n.h3,{id:"local-development",children:"Local Development"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"backend/.env"})," (copy from ",(0,r.jsx)(n.code,{children:"backend/.env.example"}),")"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Application\nAPP_NAME="Duty Call - Agent Workspace Platform"\nAPP_ENV=local\nAPP_DEBUG=true\nAPP_KEY=base64:...                    # Generated by php artisan key:generate\nAPP_URL=http://localhost:8090\n\n# Frontend (for CORS)\nFRONTEND_URL=http://localhost:3000\n\n# Database (MySQL for local)\nDB_CONNECTION=mysql\nDB_HOST=127.0.0.1\nDB_PORT=3306\nDB_DATABASE=dutycall_local\nDB_USERNAME=root\nDB_PASSWORD=                          # Your MySQL password (often empty)\n\n# Twilio Configuration\nTWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nTWILIO_AUTH_TOKEN=your_auth_token_here\nTWILIO_PHONE_NUMBER_DEV=+18316033889\nTWILIO_PHONE_NUMBER_PROD=+16282373889\n\n# WebRTC (for browser-based calling)\nTWILIO_API_KEY=SKxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nTWILIO_API_SECRET=your_api_secret_here\nTWILIO_TWIML_APP_SID=APf62bdf0bc5c380c61e8534b43ee6479e\nTWILIO_EDGE=ashburn                   # Optimize routing\n\n# Ngrok (updated automatically by dev-start.sh)\nNGROK_URL=https://your-ngrok-url.ngrok-free.app\n\n# Google OAuth (optional)\nGOOGLE_CLIENT_ID=your_client_id\nGOOGLE_CLIENT_SECRET=your_client_secret\nGOOGLE_CALLBACK_URL=http://localhost:8090/auth/google/callback\n\n# Google Sheets API (optional, for contact imports)\nGOOGLE_SERVICE_ACCOUNT_JSON=storage/app/google/service-account.json\n'})}),(0,r.jsx)(n.admonition,{title:"Important Notes",type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Never commit ",(0,r.jsx)(n.code,{children:".env"})]})," to version control (already in ",(0,r.jsx)(n.code,{children:".gitignore"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"NGROK_URL"})," is automatically updated by ",(0,r.jsx)(n.code,{children:"./dev-start.sh"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Twilio credentials"})," are for dev environment - contact project lead for full values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"APP_KEY"})," must be unique - generate with ",(0,r.jsx)(n.code,{children:"php artisan key:generate"})]}),"\n"]})})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Critical Variables"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"APP_URL"}),": Base URL for Laravel (localhost:8090)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"NGROK_URL"}),": Overrides ",(0,r.jsx)(n.code,{children:"APP_URL"})," for Twilio callbacks (local only)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DB_CONNECTION"}),": ",(0,r.jsx)(n.code,{children:"mysql"})," (local) vs ",(0,r.jsx)(n.code,{children:"pgsql"})," (production)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TWILIO_*"}),": WebRTC + TwiML configuration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FRONTEND_URL"}),": CORS whitelist"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Auto-Configuration"}),":\n",(0,r.jsx)(n.code,{children:"dev-start.sh"})," updates ",(0,r.jsx)(n.code,{children:"NGROK_URL"})," automatically:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sed -i '' \"s|NGROK_URL=.*|NGROK_URL=$NGROK_URL|\" .env\n"})})]})]}),"\n",(0,r.jsx)(n.h3,{id:"production-railway",children:"Production (Railway)"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": Railway Dashboard \u2192 Environment Variables"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Application\nAPP_ENV=production\nAPP_DEBUG=false                       # CRITICAL: Must be false in production\nAPP_KEY=base64:...                    # Generate new key for production\nAPP_URL=https://dutycall-production.up.railway.app\n\n# Frontend\nFRONTEND_URL=https://dutycall.com     # Your production domain\n\n# Database (PostgreSQL - provided by Railway)\nDB_CONNECTION=pgsql\nDB_HOST=${PGHOST}                     # Railway provides these\nDB_PORT=${PGPORT}\nDB_DATABASE=${PGDATABASE}\nDB_USERNAME=${PGUSER}\nDB_PASSWORD=${PGPASSWORD}\n\n# Twilio (production credentials)\nTWILIO_ACCOUNT_SID=your_prod_account_sid\nTWILIO_AUTH_TOKEN=your_prod_auth_token\nTWILIO_PHONE_NUMBER=+16282373889      # Production number\nTWILIO_API_KEY=your_prod_api_key\nTWILIO_API_SECRET=your_prod_api_secret\nTWILIO_TWIML_APP_SID=your_prod_twiml_app_sid\nTWILIO_EDGE=ashburn\n\n# NO NGROK_URL in production!\n# Code falls back to APP_URL automatically\n"})}),(0,r.jsx)(n.admonition,{title:"Production Security",type:"warning",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Never use local credentials in production"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Never enable ",(0,r.jsx)(n.code,{children:"APP_DEBUG=true"})," in production"]})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Always use HTTPS"})," for ",(0,r.jsx)(n.code,{children:"APP_URL"})," and ",(0,r.jsx)(n.code,{children:"FRONTEND_URL"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use strong, unique passwords"})," for all services"]}),"\n"]})})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Differences"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"APP_DEBUG=false"})," - Disable debug mode"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DB_CONNECTION=pgsql"})," - Railway uses PostgreSQL"]}),"\n",(0,r.jsxs)(n.li,{children:["No ",(0,r.jsx)(n.code,{children:"NGROK_URL"})," - Code uses ",(0,r.jsx)(n.code,{children:"APP_URL"})," fallback"]}),"\n",(0,r.jsx)(n.li,{children:"Production Twilio credentials"}),"\n",(0,r.jsx)(n.li,{children:"HTTPS URLs only"}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Railway Auto-Provides"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"PGHOST"}),", ",(0,r.jsx)(n.code,{children:"PGPORT"}),", ",(0,r.jsx)(n.code,{children:"PGDATABASE"}),", ",(0,r.jsx)(n.code,{children:"PGUSER"}),", ",(0,r.jsx)(n.code,{children:"PGPASSWORD"})]}),"\n",(0,r.jsx)(n.li,{children:"Use these in Railway dashboard, not hardcoded values"}),"\n"]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"frontend-environment-envlocal",children:"Frontend Environment (.env.local)"}),"\n",(0,r.jsx)(n.h3,{id:"local-development-1",children:"Local Development"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"frontend/.env.local"})," (copy from ",(0,r.jsx)(n.code,{children:"frontend/.env.example"}),")"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Backend API URL\nNEXT_PUBLIC_API_URL=http://localhost:8090\n\n# Environment\nNEXT_PUBLIC_APP_ENV=local\n"})}),(0,r.jsx)(n.admonition,{title:"Simple Configuration",type:"tip",children:(0,r.jsx)(n.p,{children:"Frontend only needs to know where the backend API is located. All other configuration happens on the backend."})})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"API Client"}),": ",(0,r.jsx)(n.code,{children:"src/lib/teleman-api.ts"})," reads ",(0,r.jsx)(n.code,{children:"NEXT_PUBLIC_API_URL"})]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"All requests prefixed with"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8090';\n"})})]})]}),"\n",(0,r.jsx)(n.h3,{id:"production-vercel",children:"Production (Vercel)"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": Vercel Dashboard \u2192 Environment Variables"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Backend API URL (Railway)\nNEXT_PUBLIC_API_URL=https://dutycall-production.up.railway.app\n\n# Environment\nNEXT_PUBLIC_APP_ENV=production\n"})}),(0,r.jsx)(n.admonition,{title:"Deployment",type:"info",children:(0,r.jsx)(n.p,{children:"Vercel automatically rebuilds when environment variables change. No need to manually redeploy."})})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build-time Variables"}),": ",(0,r.jsx)(n.code,{children:"NEXT_PUBLIC_*"})," are baked into bundle at build time"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Vercel Auto-Deploy"}),": Changes to env vars trigger rebuild"]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"the-ngrok_url-pattern",children:"The NGROK_URL Pattern"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsx)(n.h3,{id:"why-ngrok_url-exists",children:"Why NGROK_URL Exists"}),(0,r.jsx)(n.p,{children:"Twilio sends webhook callbacks to your server when calls happen. In production, your server has a public URL (Railway). In local development, your laptop doesn't have a public URL - that's where ngrok comes in."}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"The Problem:"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Twilio needs to reach your backend to deliver webhooks"}),"\n",(0,r.jsx)(n.li,{children:"Your laptop (localhost:8090) is not accessible from the internet"}),"\n",(0,r.jsxs)(n.li,{children:["Twilio can't call ",(0,r.jsx)(n.code,{children:"http://localhost:8090/api/twilio/inbound"})]}),"\n"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"The Solution:"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ngrok creates a public URL that tunnels to your localhost"}),"\n",(0,r.jsxs)(n.li,{children:["Example: ",(0,r.jsx)(n.code,{children:"https://abc123.ngrok-free.app"})," \u2192 ",(0,r.jsx)(n.code,{children:"localhost:8090"})]}),"\n",(0,r.jsx)(n.li,{children:"Twilio calls the ngrok URL, which forwards to your laptop"}),"\n"]}),(0,r.jsx)(n.h3,{id:"how-it-works-in-code",children:"How It Works in Code"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Backend"})," (",(0,r.jsx)(n.code,{children:"TwilioWebhookController.php"}),"):"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Generate callback URL\n$waitUrl = env('NGROK_URL', env('APP_URL')) . '/api/twilio/queue-wait';\n\n// Local: Uses NGROK_URL \u2192 https://abc123.ngrok-free.app/api/twilio/queue-wait\n// Production: Falls back to APP_URL \u2192 https://dutycall-production.up.railway.app/api/twilio/queue-wait\n"})}),(0,r.jsx)(n.p,{children:"This pattern appears throughout the codebase wherever Twilio callbacks are generated."}),(0,r.jsx)(n.h3,{id:"automatic-configuration",children:"Automatic Configuration"}),(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"./dev-start.sh"})," script handles everything:"]}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Starts ngrok tunnel to localhost:8090"}),"\n",(0,r.jsx)(n.li,{children:"Extracts the public URL from ngrok API"}),"\n",(0,r.jsxs)(n.li,{children:["Updates ",(0,r.jsx)(n.code,{children:".env"})," with ",(0,r.jsx)(n.code,{children:"NGROK_URL=https://abc123.ngrok-free.app"})]}),"\n",(0,r.jsx)(n.li,{children:"Configures Twilio dev number to use the ngrok URL"}),"\n",(0,r.jsx)(n.li,{children:"Keeps ngrok running in the foreground"}),"\n"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"You never have to manually configure this!"})})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsx)(n.h3,{id:"pattern-implementation",children:"Pattern Implementation"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Pattern"})," (appears in multiple controllers):"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$url = env('NGROK_URL', env('APP_URL')) . '/api/endpoint';\n"})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fallback Logic"}),":"]}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Check ",(0,r.jsx)(n.code,{children:"NGROK_URL"})," environment variable"]}),"\n",(0,r.jsx)(n.li,{children:"If set, use it (local development)"}),"\n",(0,r.jsxs)(n.li,{children:["If not set, fall back to ",(0,r.jsx)(n.code,{children:"APP_URL"})," (production)"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why This Works"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Local: ",(0,r.jsx)(n.code,{children:"NGROK_URL"})," is set \u2192 callbacks go through ngrok tunnel"]}),"\n",(0,r.jsxs)(n.li,{children:["Production: ",(0,r.jsx)(n.code,{children:"NGROK_URL"})," not set \u2192 callbacks go directly to Railway"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Locations in Codebase"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TwilioWebhookController.php:304-305"})," - Queue callbacks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TwilioWebhookController.php:350-360"})," - Inbound call TwiML"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DialerController.php:120-130"})," - Campaign callbacks"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Ngrok API"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# dev-start.sh extracts URL from ngrok API\ncurl -s http://localhost:4040/api/tunnels | jq -r '.tunnels[0].public_url'\n"})})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"environment-specific-differences",children:"Environment-Specific Differences"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsx)(n.h3,{id:"local-vs-production-comparison",children:"Local vs Production Comparison"}),(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Feature"}),(0,r.jsx)(n.th,{children:"Local"}),(0,r.jsx)(n.th,{children:"Production"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Backend"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"localhost:8090"})}),(0,r.jsxs)(n.td,{children:["Railway (",(0,r.jsx)(n.a,{href:"https://dutycall-production.up.railway.app",children:"https://dutycall-production.up.railway.app"}),")"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Frontend"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"localhost:3000"})}),(0,r.jsxs)(n.td,{children:["Vercel (",(0,r.jsx)(n.a,{href:"https://dutycall.com",children:"https://dutycall.com"}),")"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Database"})}),(0,r.jsx)(n.td,{children:"MySQL (localhost)"}),(0,r.jsx)(n.td,{children:"PostgreSQL (Railway)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Twilio Number"})}),(0,r.jsx)(n.td,{children:"+1 831 603 3889 (dev)"}),(0,r.jsx)(n.td,{children:"+1 628 237 3889 (prod)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Webhook Delivery"})}),(0,r.jsx)(n.td,{children:"Ngrok tunnel"}),(0,r.jsx)(n.td,{children:"Direct to Railway"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Debug Mode"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"APP_DEBUG=true"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"APP_DEBUG=false"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"SSL/HTTPS"})}),(0,r.jsx)(n.td,{children:"Not required"}),(0,r.jsx)(n.td,{children:"Required"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Google OAuth"})}),(0,r.jsx)(n.td,{children:"localhost callback"}),(0,r.jsx)(n.td,{children:"Production domain callback"})]})]})]}),(0,r.jsx)(n.h3,{id:"what-changes-between-environments",children:"What Changes Between Environments"}),(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Backend ",(0,r.jsx)(n.code,{children:".env"})," Changes:"]})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Local                              # Production\nAPP_ENV=local                        APP_ENV=production\nAPP_DEBUG=true                       APP_DEBUG=false\nAPP_URL=http://localhost:8090        APP_URL=https://dutycall-production.up.railway.app\nDB_CONNECTION=mysql                  DB_CONNECTION=pgsql\nNGROK_URL=https://xxx.ngrok.io       # Not set in production\n"})}),(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Frontend ",(0,r.jsx)(n.code,{children:".env.local"})," Changes:"]})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Local                              # Production\nNEXT_PUBLIC_API_URL=http://localhost:8090    NEXT_PUBLIC_API_URL=https://dutycall-production.up.railway.app\nNEXT_PUBLIC_APP_ENV=local                    NEXT_PUBLIC_APP_ENV=production\n"})})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsx)(n.h3,{id:"technical-differences",children:"Technical Differences"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Database"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Local: MySQL 8.0+ (",(0,r.jsx)(n.code,{children:"DB_CONNECTION=mysql"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Production: PostgreSQL (",(0,r.jsx)(n.code,{children:"DB_CONNECTION=pgsql"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Schema identical (Laravel handles differences)"}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Routing"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Local: Ngrok intercepts webhooks \u2192 tunnels to localhost"}),"\n",(0,r.jsx)(n.li,{children:"Production: Direct HTTPS to Railway"}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Security"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Local: Debug enabled, loose CORS, HTTP allowed"}),"\n",(0,r.jsx)(n.li,{children:"Production: Debug disabled, strict CORS, HTTPS enforced"}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Local: Single-process PHP server"}),"\n",(0,r.jsx)(n.li,{children:"Production: Multi-worker Railway containers"}),"\n"]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"twilio-configuration",children:"Twilio Configuration"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsx)(n.h3,{id:"phone-number-configuration",children:"Phone Number Configuration"}),(0,r.jsx)(n.p,{children:"Twilio phone numbers need to know where to send webhook callbacks. This configuration differs between local and production."}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Local Development"})," (automated by ",(0,r.jsx)(n.code,{children:"dev-start.sh"}),"):"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Phone Number: +1 831 603 3889 (dev)\nVoice URL: https://YOUR-NGROK-URL.ngrok-free.app/api/twilio/inbound (POST)\nStatus Callback: https://YOUR-NGROK-URL.ngrok-free.app/api/twilio/status (POST)\n"})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Production"})," (manual configuration in Twilio Console):"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Phone Number: +1 628 237 3889 (prod)\nVoice URL: https://dutycall-production.up.railway.app/api/twilio/inbound (POST)\nStatus Callback: https://dutycall-production.up.railway.app/api/twilio/status (POST)\n"})}),(0,r.jsx)(n.h3,{id:"twiml-app-configuration",children:"TwiML App Configuration"}),(0,r.jsx)(n.p,{children:"For WebRTC calling, Twilio needs a TwiML App configured:"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Local Development"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"TwiML App: DutyCall Dev\nVoice Request URL: https://YOUR-NGROK-URL.ngrok-free.app/api/twilio/agent-dial-queue (POST)\n"})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Production"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"TwiML App: DutyCall Production\nVoice Request URL: https://dutycall-production.up.railway.app/api/twilio/agent-dial-queue (POST)\n"})}),(0,r.jsx)(n.admonition,{title:"Update After Ngrok Restarts",type:"warning",children:(0,r.jsxs)(n.p,{children:["Every time ngrok restarts, the URL changes. The ",(0,r.jsx)(n.code,{children:"dev-start.sh"})," script automatically updates the phone number configuration, but ",(0,r.jsx)(n.strong,{children:"you may need to manually update the TwiML App Voice Request URL"})," in Twilio Console."]})}),(0,r.jsx)(n.h3,{id:"environment-variables-explained",children:"Environment Variables Explained"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"TWILIO_ACCOUNT_SID"}),": Your Twilio account identifier"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Find: Twilio Console \u2192 Account Info"}),"\n",(0,r.jsxs)(n.li,{children:["Example: ",(0,r.jsx)(n.code,{children:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"})]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"TWILIO_AUTH_TOKEN"}),": Secret key for API authentication"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Find: Twilio Console \u2192 Account Info (click "View")'}),"\n",(0,r.jsx)(n.li,{children:"Keep secret! Never commit to version control"}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"TWILIO_API_KEY"})," and ",(0,r.jsx)(n.strong,{children:"TWILIO_API_SECRET"}),": For Access Token generation"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Find: Twilio Console \u2192 Account \u2192 API Keys \u2192 Create new"}),"\n",(0,r.jsx)(n.li,{children:"Used for WebRTC browser calling"}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"TWILIO_TWIML_APP_SID"}),": TwiML Application for WebRTC routing"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Find: Twilio Console \u2192 Voice \u2192 TwiML Apps"}),"\n",(0,r.jsxs)(n.li,{children:["Example: ",(0,r.jsx)(n.code,{children:"APf62bdf0bc5c380c61e8534b43ee6479e"})]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"TWILIO_EDGE"}),": Latency optimization (optional)"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Options: ",(0,r.jsx)(n.code,{children:"ashburn"}),", ",(0,r.jsx)(n.code,{children:"dublin"}),", ",(0,r.jsx)(n.code,{children:"sydney"}),", ",(0,r.jsx)(n.code,{children:"tokyo"})]}),"\n",(0,r.jsxs)(n.li,{children:["Default: ",(0,r.jsx)(n.code,{children:"ashburn"})," (US East Coast)"]}),"\n"]})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsx)(n.h3,{id:"webhook-endpoints",children:"Webhook Endpoints"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Phone Number Webhooks"})," (Twilio \u2192 Backend):"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/twilio/inbound"})," - Incoming call handler"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/twilio/status"})," - Call status updates"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"TwiML App Webhooks"})," (WebRTC \u2192 Backend):"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/twilio/agent-dial-queue"})," - Agent browser joins queue"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/twilio/handle-call"})," - Manual dialer call handler"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Queue System Webhooks"})," (Twilio \u2192 Backend):"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/twilio/queue-wait"})," - Hold music provider"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /api/twilio/dequeue"})," - Queue cleanup"]}),"\n"]}),(0,r.jsx)(n.h3,{id:"access-token-generation",children:"Access Token Generation"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"VoiceTokenController.php"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$token = new AccessToken($accountSid, $apiKey, $apiSecret, 3600, $identity);\n$voiceGrant = new VoiceGrant();\n$voiceGrant->setOutgoingApplicationSid($twimlAppSid);\n$token->addGrant($voiceGrant);\n"})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Frontend consumes"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const { token } = await api.getVoiceToken();\ndevice = new Device(token);\nawait device.register();\n"})})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cors-configuration",children:"CORS Configuration"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsx)(n.h3,{id:"understanding-cors",children:"Understanding CORS"}),(0,r.jsx)(n.p,{children:"CORS (Cross-Origin Resource Sharing) controls which domains can access your backend API. Since the frontend and backend run on different domains (localhost:3000 and localhost:8090), CORS must be configured."}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Backend"})," (",(0,r.jsx)(n.code,{children:"config/cors.php"}),"):"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"return [\n    'paths' => ['api/*', 'sanctum/csrf-cookie', 'dashboard/*', 'auth/*', 'analytics/*'],\n    'allowed_origins' => [env('FRONTEND_URL', 'http://localhost:3000')],\n    'allowed_methods' => ['*'],\n    'allowed_headers' => ['*'],\n    'supports_credentials' => true,\n];\n"})}),(0,r.jsx)(n.h3,{id:"local-development-2",children:"Local Development"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Backend .env\nFRONTEND_URL=http://localhost:3000\n"})}),(0,r.jsxs)(n.p,{children:["This allows requests from ",(0,r.jsx)(n.code,{children:"http://localhost:3000"})," to access the backend API."]}),(0,r.jsx)(n.h3,{id:"production",children:"Production"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Backend .env (Railway)\nFRONTEND_URL=https://dutycall.com\n"})}),(0,r.jsx)(n.p,{children:"This restricts API access to only your production frontend domain."}),(0,r.jsx)(n.admonition,{title:"Security",type:"warning",children:(0,r.jsxs)(n.p,{children:["Never use ",(0,r.jsx)(n.code,{children:"'allowed_origins' => ['*']"})," in production - this allows any website to access your API!"]})})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsx)(n.h3,{id:"cors-implementation",children:"CORS Implementation"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Laravel Config"})," (",(0,r.jsx)(n.code,{children:"config/cors.php"}),"):"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Whitelists frontend domain via ",(0,r.jsx)(n.code,{children:"FRONTEND_URL"})]}),"\n",(0,r.jsx)(n.li,{children:"Enables credentials (cookies, auth headers)"}),"\n",(0,r.jsx)(n.li,{children:"Allows all methods/headers for simplicity"}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Sanctum Integration"}),":"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// config/sanctum.php\n'stateful' => explode(',', env('SANCTUM_STATEFUL_DOMAINS', 'localhost,localhost:3000')),\n"})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why Credentials Matter"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Bearer tokens in ",(0,r.jsx)(n.code,{children:"Authorization"})," header"]}),"\n",(0,r.jsx)(n.li,{children:"CSRF cookies for session-based auth"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"supports_credentials' => true"})," required"]}),"\n"]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"common-configuration-issues",children:"Common Configuration Issues"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsx)(n.h3,{id:"issue-frontend-cant-connect-to-backend",children:"Issue: Frontend Can't Connect to Backend"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": API calls fail with network errors or 404s"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Backend running on ",(0,r.jsx)(n.code,{children:"localhost:8090"}),"?"]}),"\n",(0,r.jsxs)(n.li,{children:["Frontend ",(0,r.jsx)(n.code,{children:".env.local"})," has ",(0,r.jsx)(n.code,{children:"NEXT_PUBLIC_API_URL=http://localhost:8090"}),"?"]}),"\n",(0,r.jsxs)(n.li,{children:["CORS configured in ",(0,r.jsx)(n.code,{children:"backend/config/cors.php"}),"?"]}),"\n"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Backend\ncd backend\nphp artisan config:clear\nphp artisan cache:clear\n\n# Frontend\ncd frontend\nrm -rf .next\nnpm run dev\n"})}),(0,r.jsx)(n.h3,{id:"issue-twilio-webhooks-failing",children:"Issue: Twilio Webhooks Failing"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Calls fail, webhooks return 404 or 500 errors"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:".env"})," has correct ",(0,r.jsx)(n.code,{children:"NGROK_URL"}),"?"]}),"\n",(0,r.jsxs)(n.li,{children:["Ngrok tunnel active? ",(0,r.jsx)(n.code,{children:"curl http://localhost:4040/api/tunnels"})]}),"\n",(0,r.jsxs)(n.li,{children:["Backend restarted after ",(0,r.jsx)(n.code,{children:".env"})," changes?"]}),"\n",(0,r.jsx)(n.li,{children:"Twilio phone number pointing to ngrok URL?"}),"\n"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Restart ngrok and backend\npkill -f ngrok\npkill -f "php artisan serve"\n./dev-start.sh  # In one terminal\nphp artisan serve --port=8090  # In another terminal\n'})}),(0,r.jsx)(n.h3,{id:"issue-device-not-registering-webrtc",children:"Issue: Device Not Registering (WebRTC)"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),': "Device not registered" errors in frontend']}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Twilio credentials correct in backend ",(0,r.jsx)(n.code,{children:".env"}),"?"]}),"\n",(0,r.jsxs)(n.li,{children:["Token endpoint working? ",(0,r.jsx)(n.code,{children:"curl http://localhost:8090/api/voice/token"})]}),"\n",(0,r.jsx)(n.li,{children:"Browser console showing errors?"}),"\n",(0,r.jsx)(n.li,{children:"TwiML App configured with correct URL?"}),"\n"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Test token generation\ncurl -X POST http://localhost:8090/api/voice/token \\\n  -H "Authorization: Bearer YOUR_AUTH_TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"recording_enabled": false}\'\n'})})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsx)(n.h3,{id:"debugging-patterns",children:"Debugging Patterns"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CORS Errors"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Check ",(0,r.jsx)(n.code,{children:"FRONTEND_URL"})," matches actual frontend origin"]}),"\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:"config/cors.php"})," includes API paths"]}),"\n",(0,r.jsx)(n.li,{children:"Clear Laravel config cache"}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Webhook Failures"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:".env"})," loaded: ",(0,r.jsx)(n.code,{children:"php artisan tinker --execute=\"dump(env('NGROK_URL'))\""})]}),"\n",(0,r.jsxs)(n.li,{children:["Check ngrok active: ",(0,r.jsx)(n.code,{children:"curl -s http://localhost:4040/api/tunnels | jq"})]}),"\n",(0,r.jsxs)(n.li,{children:["Inspect ngrok requests: ",(0,r.jsx)(n.code,{children:"http://localhost:4040"})," dashboard"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"WebRTC Issues"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Validate credentials: Check Twilio Console"}),"\n",(0,r.jsx)(n.li,{children:"Test token endpoint: cURL with Bearer token"}),"\n",(0,r.jsx)(n.li,{children:"Check browser console: Device initialization errors"}),"\n"]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(o.A,{groupId:"developer-type",children:[(0,r.jsxs)(c.A,{value:"human",label:"\ud83d\udc68\u200d\ud83d\udcbb Human Developer",default:!0,children:[(0,r.jsx)(n.h3,{id:"security",children:"Security"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Never commit ",(0,r.jsx)(n.code,{children:".env"})," files"]})," to version control"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use different credentials"})," for local and production"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Disable debug mode"})," in production (",(0,r.jsx)(n.code,{children:"APP_DEBUG=false"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use HTTPS"})," for all production URLs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rotate Twilio credentials"})," periodically"]}),"\n"]}),(0,r.jsx)(n.h3,{id:"development-workflow",children:"Development Workflow"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Keep ",(0,r.jsx)(n.code,{children:".env.example"})," updated"]})," when adding new variables"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Document all environment variables"})," in this guide"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Use ",(0,r.jsx)(n.code,{children:"dev-start.sh"})]})," for ngrok automation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clear Laravel cache"})," after changing ",(0,r.jsx)(n.code,{children:".env"}),": ",(0,r.jsx)(n.code,{children:"php artisan config:clear"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rebuild frontend"})," after changing ",(0,r.jsx)(n.code,{children:"NEXT_PUBLIC_*"})," variables"]}),"\n"]}),(0,r.jsx)(n.h3,{id:"production-deployment",children:"Production Deployment"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test locally first"})," before deploying to production"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use Railway environment variables"})," (not hardcoded values)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitor logs"})," after deployment for configuration errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keep production credentials secret"})," - don't share in Slack/email"]}),"\n"]})]}),(0,r.jsxs)(c.A,{value:"ai",label:"\ud83e\udd16 AI Agent",children:[(0,r.jsx)(n.h3,{id:"configuration-management",children:"Configuration Management"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Version Control"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Commit: ",(0,r.jsx)(n.code,{children:".env.example"}),", ",(0,r.jsx)(n.code,{children:"config/*.php"})]}),"\n",(0,r.jsxs)(n.li,{children:["Ignore: ",(0,r.jsx)(n.code,{children:".env"}),", ",(0,r.jsx)(n.code,{children:".env.local"}),", ",(0,r.jsx)(n.code,{children:".env.production"})]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Change Detection"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Laravel: ",(0,r.jsx)(n.code,{children:"php artisan config:cache"})," after ",(0,r.jsx)(n.code,{children:".env"})," changes"]}),"\n",(0,r.jsxs)(n.li,{children:["Next.js: Rebuild required for ",(0,r.jsx)(n.code,{children:"NEXT_PUBLIC_*"})," changes"]}),"\n"]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Secret Management"}),":"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use Railway/Vercel secret management"}),"\n",(0,r.jsx)(n.li,{children:"Never log sensitive values"}),"\n",(0,r.jsx)(n.li,{children:"Rotate credentials on compromise"}),"\n"]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Your Configuration"}),": ",(0,r.jsx)(n.a,{href:"/developers/getting-started/local-setup",children:"Local Setup Guide"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Understand Architecture"}),": ",(0,r.jsx)(n.a,{href:"/developers/overview",children:"Developer Overview"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Need Help?"})," Contact the project lead or check ",(0,r.jsx)(n.code,{children:"backend/README.md"})," for detailed configuration reference."]})]})}function x(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);